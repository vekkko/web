<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dimensionamiento Inicial Sistema Solar REDERAR</title>
    <!-- Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #002244; /* Deep blue from the logo */
        }
        .rederar-yellow {
            color: #FFC107; /* Yellow from the sun in the logo */
        }
        .rederar-blue {
            color: #0056B3; /* A medium blue from the wave in the logo */
        }
        .bg-rederar-blue {
            background-color: #0056B3;
        }
    </style>
</head>
<body class="p-4 sm:p-8">

    <!-- Main Container -->
    <div class="max-w-7xl mx-auto bg-white rounded-2xl shadow-xl overflow-hidden p-6 sm:p-10">
        <!-- Logo and Title -->
        <div class="flex flex-col items-center mb-8">
            <!-- Logo de REDERAR implementado con la URL proporcionada y un tamaño mayor -->
            <img src="https://i.postimg.cc/NKXQP4LY/LOGO-2024.jpg" alt="Logo de REDERAR" class="mb-4 h-24 object-contain">
            <h1 class="text-4xl font-extrabold text-center text-gray-800 mb-2">
                DIMENSIONAMIENTO INICIAL SISTEMA SOLAR
            </h1>
            <p class="text-center text-gray-600">Dimensiona tu sistema On-Grid o Off-Grid y solicita una cotización.</p>
        </div>

        <!-- Client Information Section -->
        <div class="bg-rederar-blue p-6 rounded-xl shadow-lg mb-10 border border-blue-600">
            <div class="flex items-center mb-4 text-white">
                <div class="bg-white p-3 rounded-full text-rederar-blue mr-4 shadow-md">
                    <i class="fas fa-user"></i>
                </div>
                <h2 class="text-2xl font-bold">Datos del Cliente</h2>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <label for="clientName" class="block text-sm font-medium text-white">Nombre Completo</label>
                    <input type="text" id="clientName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rederar-blue focus:ring-rederar-blue p-2 border" placeholder="Juan Pérez">
                </div>
                <div>
                    <label for="clientPhone" class="block text-sm font-medium text-white">Teléfono</label>
                    <input type="tel" id="clientPhone" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rederar-blue focus:ring-rederar-blue p-2 border" placeholder="+5493434802264">
                </div>
                <div>
                    <label for="clientAddress" class="block text-sm font-medium text-white">Dirección</label>
                    <input type="text" id="clientAddress" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rederar-blue focus:ring-rederar-blue p-2 border" placeholder="Av. Siempre Viva 742, Paraná">
                </div>
            </div>
        </div>
        
        <!-- On-Grid and Off-Grid Calculators Container -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
            <!-- On-Grid Calculator Section -->
            <div class="bg-gray-100 p-6 rounded-xl shadow-lg border border-gray-200">
                <div class="flex items-center mb-4">
                    <div class="bg-rederar-blue p-3 rounded-full text-white mr-4 shadow-md">
                        <i class="fas fa-plug"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-rederar-blue">Sistema On-Grid</h2>
                </div>
                <p class="text-gray-600 mb-6">Calcula el tamaño del sistema solar conectado a la red. Ingresa tu consumo anual y la provincia para obtener la estimación.</p>

                <div class="space-y-4 mb-6">
                    <div>
                        <label for="annualKwh" class="block text-sm font-medium text-gray-700">Consumo anual (kWh)</label>
                        <input type="number" id="annualKwh" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rederar-blue focus:ring-rederar-blue p-2 border" placeholder="e.g., 3000">
                    </div>
                    <div>
                        <label for="provinceOnGrid" class="block text-sm font-medium text-gray-700">Provincia</label>
                        <select id="provinceOnGrid" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-rederar-blue focus:ring-rederar-blue p-2 border">
                            <option value="">Selecciona una provincia</option>
                        </select>
                    </div>
                </div>

                <div id="onGridResults" class="hidden mt-6 transition-all duration-300">
                    <div id="onGridErrorMessage" class="text-red-600 text-sm font-semibold mb-2"></div>
                    <div id="onGridSuccessContent" class="space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-300">
                        <p id="onGridSystemSizeResult" class="text-rederar-blue font-semibold"></p>
                        <p id="onGridGenerationResult" class="text-rederar-blue font-semibold"></p>
                    </div>
                </div>

                <div class="mt-6 flex flex-col sm:flex-row gap-4">
                    <button onclick="calculateOnGridSystem()" class="flex-1 w-full sm:w-auto bg-rederar-blue hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300">
                        Calcular Sistema On-Grid
                    </button>
                    <button onclick="sendOnGridQuoteRequest()" class="flex-1 w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300">
                        <i class="fab fa-whatsapp mr-2"></i> Solicitar Cotización
                    </button>
                </div>
            </div>

            <!-- Off-Grid Calculator Section -->
            <div class="bg-gray-100 p-6 rounded-xl shadow-lg border border-gray-200">
                <div class="flex items-center mb-4">
                    <div class="bg-rederar-blue p-3 rounded-full text-white mr-4 shadow-md">
                        <i class="fas fa-battery-three-quarters"></i>
                    </div>
                    <h2 class="text-2xl font-bold text-rederar-blue">Sistema Off-Grid</h2>
                </div>
                <p class="text-gray-600 mb-6">Calcula los componentes para un sistema aislado. Agrega tus artefactos y selecciona la provincia para obtener la estimación.</p>
                
                <div class="space-y-4 mb-6">
                    <!-- Artifact Input Form -->
                    <div class="grid grid-cols-2 sm:grid-cols-4 gap-4 items-end">
                        <div>
                            <label for="applianceName" class="block text-sm font-medium text-gray-700">Artefacto</label>
                            <input type="text" id="applianceName" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., Heladera">
                        </div>
                        <div>
                            <label for="applianceQuantity" class="block text-sm font-medium text-gray-700">Cantidad</label>
                            <input type="number" id="applianceQuantity" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., 1">
                        </div>
                        <div>
                            <label for="applianceConsumption" class="block text-sm font-medium text-gray-700">Consumo (W)</label>
                            <input type="number" id="applianceConsumption" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., 100">
                        </div>
                        <div>
                            <label for="applianceHours" class="block text-sm font-medium text-gray-700">Horas/día</label>
                            <input type="number" id="applianceHours" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., 24">
                        </div>
                        <div class="col-span-2 sm:col-span-4">
                            <button onclick="addArtifact()" class="w-full bg-rederar-blue hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-full shadow-lg transition duration-300">
                                Agregar Artefacto
                            </button>
                        </div>
                    </div>

                    <!-- Artifacts Table -->
                    <div class="overflow-x-auto shadow rounded-lg border border-gray-300">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-200">
                                <tr>
                                    <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Artefacto</th>
                                    <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cant.</th>
                                    <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Consumo (W)</th>
                                    <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Hs/día</th>
                                    <th scope="col" class="px-3 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Consumo Diario (kWh)</th>
                                    <th scope="col" class="px-3 py-2"></th>
                                </tr>
                            </thead>
                            <tbody id="artifactTableBody" class="bg-white divide-y divide-gray-200">
                                <!-- Table rows will be inserted here by JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="space-y-4 mb-6">
                    <div>
                        <label for="totalDailyConsumption" class="block text-sm font-bold text-gray-700">Consumo diario total:</label>
                        <span id="totalDailyConsumption" class="mt-1 text-lg font-bold text-rederar-blue">0.00 kWh</span>
                    </div>
                    <div>
                        <label for="autonomyDays" class="block text-sm font-medium text-gray-700">Días de autonomía de la batería</label>
                        <input type="number" id="autonomyDays" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border" placeholder="e.g., 2">
                    </div>
                    <div>
                        <label for="provinceOffGrid" class="block text-sm font-medium text-gray-700">Provincia</label>
                        <select id="provinceOffGrid" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm p-2 border">
                            <option value="">Selecciona una provincia</option>
                        </select>
                    </div>
                </div>

                <div id="offGridResults" class="hidden mt-6 transition-all duration-300">
                    <div id="offGridErrorMessage" class="text-red-600 text-sm font-semibold mb-2"></div>
                    <div id="offGridSuccessContent" class="space-y-3 p-4 bg-blue-50 rounded-lg border border-blue-300">
                        <p id="offGridPanelResult" class="text-rederar-blue font-semibold"></p>
                        <p id="offGridBatteryResult" class="text-rederar-blue font-semibold"></p>
                    </div>
                </div>
                
                <div class="mt-6 flex flex-col sm:flex-row gap-4">
                    <button onclick="calculateOffGridSystem()" class="flex-1 w-full sm:w-auto bg-rederar-blue hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300">
                        Calcular Sistema Off-Grid
                    </button>
                    <button onclick="sendOffGridQuoteRequest()" class="flex-1 w-full sm:w-auto bg-green-500 hover:bg-green-600 text-white font-bold py-3 px-6 rounded-full shadow-lg transition duration-300">
                        <i class="fab fa-whatsapp mr-2"></i> Solicitar Cotización
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer with Logo and Copyright -->
    <footer class="mt-10 py-6 text-center text-white bg-rederar-blue rounded-xl max-w-7xl mx-auto shadow-inner border border-blue-600">
        <div class="flex justify-center items-center mb-2">
            <!-- Logo de REDERAR implementado con la URL proporcionada y un tamaño mayor -->
            <img src="https://i.postimg.cc/NKXQP4LY/LOGO-2024.jpg" alt="Logo de REDERAR" class="h-16 object-contain">
        </div>
        <p class="text-sm text-gray-300">&copy; 2024 REDERAR. Todos los derechos reservados.</p>
    </footer>

    <!-- Custom Alert Modal -->
    <div id="custom-alert-modal" class="fixed inset-0 z-50 flex items-center justify-center bg-gray-900 bg-opacity-50 hidden">
        <div class="bg-white p-6 rounded-xl shadow-2xl max-w-sm w-full mx-4">
            <h3 class="text-lg font-bold text-gray-800 mb-4">Aviso</h3>
            <p id="custom-alert-message" class="text-gray-700 mb-6"></p>
            <button onclick="closeAlert()" class="w-full bg-rederar-blue hover:bg-blue-700 text-white font-bold py-2 rounded-full transition duration-300">
                Aceptar
            </button>
        </div>
    </div>

    <script>
        // Data for provinces and localities in Argentina, including the HSP (Horas Solares Pico)
        const provinceData = {
            'buenos-aires': { name: 'Buenos Aires', hsp: 4.5, localidades: ['La Plata', 'Mar del Plata', 'Bahía Blanca', 'Tandil', 'Zárate', 'San Nicolás', 'Junín', 'Olavarría', 'Pergamino'] },
            'cordoba': { name: 'Córdoba', hsp: 4.9, localidades: ['Córdoba Capital', 'Villa Carlos Paz', 'Río Cuarto', 'San Francisco', 'Villa María', 'Río Tercero'] },
            'santa-fe': { name: 'Santa Fe', hsp: 4.7, localidades: ['Santa Fe Capital', 'Rosario', 'Reconquista', 'Venado Tuerto', 'Rafaela', 'Esperanza'] },
            'mendoza': { name: 'Mendoza', hsp: 5.6, localidades: ['Mendoza Capital', 'San Rafael', 'Malargüe', 'General Alvear', 'Tunuyán', 'Godoy Cruz'] },
            'tucuman': { name: 'Tucumán', hsp: 5.1, localidades: ['San Miguel de Tucumán', 'Yerba Buena', 'Concepción', 'Tafí Viejo', 'Alderetes'] },
            'entre-rios': { name: 'Entre Ríos', hsp: 4.8, localidades: ['Paraná', 'Concordia', 'Gualeguaychú', 'Villaguay', 'La Paz', 'Victoria'] },
            'salta': { name: 'Salta', hsp: 5.5, localidades: ['Salta Capital', 'Orán', 'Cafayate', 'Tartagal', 'Metán', 'Rosario de la Frontera'] },
            'corrientes': { name: 'Corrientes', hsp: 4.6, localidades: ['Corrientes Capital', 'Goya', 'Paso de los Libres', 'Mercedes', 'Curuzú Cuatiá', 'Santo Tomé'] },
            'misiones': { name: 'Misiones', hsp: 4.6, localidades: ['Posadas', 'Iguazú', 'Oberá', 'Eldorado', 'Apóstoles', 'Puerto Rico'] },
            'chaco': { name: 'Chaco', hsp: 4.9, localidades: ['Resistencia', 'Sáenz Peña', 'Villa Ángela', 'Castelli', 'Charata', 'Quitilipi'] },
            'santiago-del-estero': { name: 'Santiago del Estero', hsp: 5.3, localidades: ['Santiago del Estero Capital', 'La Banda', 'Termas de Río Hondo', 'Frías', 'Loreto'] },
            'san-juan': { name: 'San Juan', hsp: 5.8, localidades: ['San Juan Capital', 'Rivadavia', 'Caucete', 'Jáchal', 'Albardón', 'San Martín'] },
            'san-luis': { name: 'San Luis', hsp: 5.2, localidades: ['San Luis Capital', 'Villa Mercedes', 'Merlo', 'La Punta', 'Santa Rosa del Conlara'] },
            'catamarca': { name: 'Catamarca', hsp: 5.4, localidades: ['San Fernando del Valle de Catamarca', 'Andalgalá', 'Tinogasta', 'Belén', 'Recreo', 'Fray Mamerto Esquiú'] },
            'la-rioja': { name: 'La Rioja', hsp: 5.7, localidades: ['La Rioja Capital', 'Chilecito', 'Arauco', 'Chamical', 'Chepes'] },
            'jujuy': { name: 'Jujuy', hsp: 5.6, localidades: ['San Salvador de Jujuy', 'Palpalá', 'La Quiaca', 'Perico', 'Libertador General San Martín'] },
            'la-pampa': { name: 'La Pampa', hsp: 5.1, localidades: ['Santa Rosa', 'General Pico', 'Toay', 'Eduardo Castex', 'Victorica'] },
            'neuquen': { name: 'Neuquén', hsp: 4.2, localidades: ['Neuquén Capital', 'San Martín de los Andes', 'Villa La Angostura', 'Cutral Có', 'Plottier'] },
            'rio-negro': { name: 'Río Negro', hsp: 4.4, localidades: ['Viedma', 'Bariloche', 'General Roca', 'Cipolletti', 'San Antonio Oeste'] },
            'chubut': { name: 'Chubut', hsp: 4.3, localidades: ['Rawson', 'Comodoro Rivadavia', 'Puerto Madryn', 'Trelew', 'Esquel'] },
            'santa-cruz': { name: 'Santa Cruz', hsp: 3.9, localidades: ['Río Gallegos', 'Caleta Olivia', 'El Calafate', 'Pico Truncado', 'Las Heras'] },
            'tierra-del-fuego': { name: 'Tierra del Fuego', hsp: 3.5, localidades: ['Ushuaia', 'Río Grande', 'Tolhuin'] },
            'formosa': { name: 'Formosa', hsp: 4.8, localidades: ['Formosa Capital', 'Clorinda', 'El Colorado', 'Pirané', 'Ingeniero Juárez'] }
        };

        // Custom alert modal functions
        function showAlert(message) {
            document.getElementById('custom-alert-message').innerText = message;
            document.getElementById('custom-alert-modal').classList.remove('hidden');
        }

        function closeAlert() {
            document.getElementById('custom-alert-modal').classList.add('hidden');
        }

        // Función para poblar los menús de provincias
        function populateProvinces(selectId) {
            const provinceSelect = document.getElementById(selectId);
            if (!provinceSelect) return;
            provinceSelect.innerHTML = '<option value="">Selecciona una provincia</option>';
            for (const key in provinceData) {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = provinceData[key].name;
                provinceSelect.appendChild(option);
            }
        }
        
        document.addEventListener('DOMContentLoaded', () => {
            populateProvinces('provinceOnGrid');
            populateProvinces('provinceOffGrid');
        });

        // Función para la calculadora on-grid
        function calculateOnGridSystem() {
            const annualKwh = parseFloat(document.getElementById('annualKwh').value);
            const selectedProvinceKey = document.getElementById('provinceOnGrid').value;
            
            const resultsDiv = document.getElementById('onGridResults');
            const errorMessage = document.getElementById('onGridErrorMessage');
            const successContent = document.getElementById('onGridSuccessContent');

            resultsDiv.classList.remove('hidden');

            if (isNaN(annualKwh) || annualKwh <= 0 || !selectedProvinceKey) {
                errorMessage.innerText = 'Por favor, ingresa un consumo anual válido y selecciona una provincia.';
                successContent.classList.add('hidden');
                return;
            }

            errorMessage.innerText = '';
            successContent.classList.remove('hidden');

            const systemEfficiency = 0.85;
            const hsp = provinceData[selectedProvinceKey].hsp;

            const idealSystemSize = (annualKwh / (hsp * 365 * systemEfficiency)).toFixed(2);
            const estimatedAnnualGeneration = idealSystemSize * hsp * 365 * systemEfficiency;

            document.getElementById('onGridSystemSizeResult').innerText = `El tamaño ideal de sistema solar para tu consumo es de: ${idealSystemSize} kW.`;
            document.getElementById('onGridGenerationResult').innerText = `Este sistema podría generar hasta ${estimatedAnnualGeneration.toFixed(0)} kWh anualmente, cubriendo tu consumo actual.`;
        }
        
        // Función para enviar la cotización On-Grid por WhatsApp
        function sendOnGridQuoteRequest() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const clientAddress = document.getElementById('clientAddress').value.trim();
            const annualKwh = document.getElementById('annualKwh').value;
            const selectedProvinceName = document.getElementById('provinceOnGrid').options[document.getElementById('provinceOnGrid').selectedIndex].text;
            const systemSizeResult = document.getElementById('onGridSystemSizeResult').innerText;

            if (!clientName || !clientPhone || !clientAddress || !annualKwh || systemSizeResult === "" || !selectedProvinceName) {
                showAlert('Por favor, completa los datos del cliente y realiza la simulación del sistema On-Grid primero.');
                return;
            }

            const message = `*SOLICITUD DE COTIZACIÓN ON-GRID*\n\n` +
                            `*Datos del Cliente:*\n` +
                            `Nombre: ${clientName}\n` +
                            `Teléfono: ${clientPhone}\n` +
                            `Dirección: ${clientAddress}\n` +
                            `Provincia: ${selectedProvinceName}\n\n` +
                            `*Dimensionamiento Inicial:*\n` +
                            `Consumo anual: ${annualKwh} kWh\n` +
                            `${systemSizeResult}\n`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://api.whatsapp.com/send?phone=+543434802264&text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
        }

        // Función para la calculadora off-grid
        function calculateOffGridSystem() {
            const totalDailyConsumptionElement = document.getElementById('totalDailyConsumption');
            const dailyKwh = parseFloat(totalDailyConsumptionElement.innerText.replace(' kWh', ''));
            const autonomyDays = parseFloat(document.getElementById('autonomyDays').value);
            const selectedProvinceKey = document.getElementById('provinceOffGrid').value;

            const resultsDiv = document.getElementById('offGridResults');
            const errorMessage = document.getElementById('offGridErrorMessage');
            const successContent = document.getElementById('offGridSuccessContent');
            
            resultsDiv.classList.remove('hidden');

            if (isNaN(dailyKwh) || dailyKwh <= 0 || isNaN(autonomyDays) || autonomyDays <= 0 || !selectedProvinceKey) {
                errorMessage.innerText = 'Por favor, agrega al menos un artefacto y completa todos los campos con valores válidos.';
                successContent.classList.add('hidden');
                return;
            }

            errorMessage.innerText = '';
            successContent.classList.remove('hidden');

            const systemEfficiency = 0.8;
            const batteryEfficiency = 0.85;
            const hsp = provinceData[selectedProvinceKey].hsp;

            const batterySize = ((dailyKwh * autonomyDays) / batteryEfficiency).toFixed(2);
            const panelSize = ((dailyKwh / (hsp * systemEfficiency)) * 1.2).toFixed(2);
            
            document.getElementById('offGridPanelResult').innerText = `Tamaño de los paneles solares: ${panelSize} kWp.`;
            document.getElementById('offGridBatteryResult').innerText = `Capacidad del banco de baterías: ${batterySize} kWh.`;
        }

        // Función para enviar la cotización Off-Grid por WhatsApp
        function sendOffGridQuoteRequest() {
            const clientName = document.getElementById('clientName').value.trim();
            const clientPhone = document.getElementById('clientPhone').value.trim();
            const clientAddress = document.getElementById('clientAddress').value.trim();
            const totalDailyConsumptionElement = document.getElementById('totalDailyConsumption');
            const dailyKwh = parseFloat(totalDailyConsumptionElement.innerText.replace(' kWh', ''));
            const autonomyDays = document.getElementById('autonomyDays').value;
            const selectedProvinceName = document.getElementById('provinceOffGrid').options[document.getElementById('provinceOffGrid').selectedIndex].text;
            const panelResult = document.getElementById('offGridPanelResult').innerText;
            const batteryResult = document.getElementById('offGridBatteryResult').innerText;

            if (!clientName || !clientPhone || !clientAddress || isNaN(dailyKwh) || dailyKwh <= 0 || panelResult === "" || batteryResult === "") {
                showAlert('Por favor, completa los datos del cliente y realiza la simulación del sistema Off-Grid primero.');
                return;
            }

            const message = `*SOLICITUD DE COTIZACIÓN OFF-GRID*\n\n` +
                            `*Datos del Cliente:*\n` +
                            `Nombre: ${clientName}\n` +
                            `Teléfono: ${clientPhone}\n` +
                            `Dirección: ${clientAddress}\n` +
                            `Provincia: ${selectedProvinceName}\n\n` +
                            `*Dimensionamiento Inicial:*\n` +
                            `Consumo diario total: ${dailyKwh} kWh\n` +
                            `Autonomía de baterías: ${autonomyDays} días\n` +
                            `${panelResult}\n` +
                            `${batteryResult}\n`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappUrl = `https://api.whatsapp.com/send?phone=+543434802264&text=${encodedMessage}`;
            
            window.open(whatsappUrl, '_blank');
        }

        // Función para agregar un artefacto a la tabla
        function addArtifact() {
            const nameInput = document.getElementById('applianceName');
            const quantityInput = document.getElementById('applianceQuantity');
            const consumptionInput = document.getElementById('applianceConsumption');
            const hoursInput = document.getElementById('applianceHours');
            
            const name = nameInput.value.trim();
            const quantity = parseFloat(quantityInput.value);
            const consumption = parseFloat(consumptionInput.value);
            const hours = parseFloat(hoursInput.value);

            if (!name || isNaN(quantity) || quantity <= 0 || isNaN(consumption) || consumption <= 0 || isNaN(hours) || hours <= 0) {
                showAlert('Por favor, completa todos los campos con valores válidos para agregar un artefacto.');
                return;
            }
            
            const dailyKwh = (quantity * consumption * hours / 1000).toFixed(2);
            
            const tableBody = document.getElementById('artifactTableBody');
            const newRow = document.createElement('tr');
            newRow.classList.add('bg-white');
            newRow.innerHTML = `
                <td class="px-3 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${name}</td>
                <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">${quantity}</td>
                <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">${consumption}</td>
                <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500">${hours}</td>
                <td class="px-3 py-2 whitespace-nowrap text-sm text-gray-500" data-daily-kwh="${dailyKwh}">${dailyKwh} kWh</td>
                <td class="px-3 py-2 whitespace-nowrap text-sm font-medium">
                    <button onclick="removeArtifact(this)" class="text-red-600 hover:text-red-900">Eliminar</button>
                </td>
            `;
            tableBody.appendChild(newRow);

            nameInput.value = '';
            quantityInput.value = '';
            consumptionInput.value = '';
            hoursInput.value = '';
            
            calculateTotalConsumption();
        }

        // Función para eliminar un artefacto de la tabla
        function removeArtifact(button) {
            const row = button.closest('tr');
            row.remove();
            calculateTotalConsumption();
        }

        // Función para calcular el consumo diario total de todos los artefactos
        function calculateTotalConsumption() {
            const tableRows = document.querySelectorAll('#artifactTableBody tr');
            let totalConsumption = 0;
            tableRows.forEach(row => {
                const kwhCell = row.querySelector('[data-daily-kwh]');
                if (kwhCell) {
                    totalConsumption += parseFloat(kwhCell.dataset.dailyKwh);
                }
            });
            document.getElementById('totalDailyConsumption').innerText = `${totalConsumption.toFixed(2)} kWh`;
        }
    </script>
</body>
</html>
